#!/usr/bin/env bash
#
# Check if completion script is provided in the official Bash/Zsh/Fish channels
#
# Usage: check-if-completion-available-to {bash|zsh|fish} <command-name>
#
#   Create fish completion script for conda.
#
#   $ ./check-if-completion-available-to fish conda
#
#

set -o errexit
set -o nounset
set -o pipefail
if [[ "${TRACE-0}" == "1" ]]; then
    set -o xtrace
fi

if [[ ! "$(command -v curl)" ]]; then
    echo "[error] curl is missing"
    exit 1
fi

toshell=$1
name="$2"

if (( "$#" != 2 ))  || [[ "${1-}" =~ ^-*h(elp)?$ ]]; then
    echo "Usage: check-if-completion-available-to {bash|zsh|fish} <command>"
    exit 1
fi

case "$toshell" in
  bash)
    url="https://raw.githubusercontent.com/scop/bash-completion/master/completions/$name"
    ;;
  zsh)
    url="https://raw.githubusercontent.com/zsh-users/zsh-completions/master/src/_$name"
    ;;
  fish)
    url="https://raw.githubusercontent.com/fish-shell/fish-shell/master/share/completions/$name.fish"
    ;;
  *)
    echo "ERROR: The first argument must be either 'bash', 'zsh', or 'fish'."
    exit 1
    ;;
esac

echo "Running: check-if-completion-available-to $toshell $name ..."
curl --output /dev/null --silent --head --fail "$url"

